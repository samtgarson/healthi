function homeFunc() {
    $(".closed").removeClass("closed");
    var dragged = 0;
    $(".slider-nav li").on("touchstart mousedown", function() {
        dragged = 0, $(this).on("touchmove mousemove", function() {
            dragged = 1;
        });
    }).on("touchend mouseup", function() {
        dragged || slideAll($(this).index());
    });
}

function dragStop() {
    var navArray = [ 0, -79, -158, -237 ], navTarget = parseInt($(".selector ul").css("marginLeft")), navIndex = nearest(navTarget, navArray)[1];
    slideAll(navIndex);
}

function pageDragStop() {
    var pageArray = [ 0, -100, -200, -300 ], pageTarget = parseInt($(".slider-content").css("left")) / $(".slider-content").width(), pageIndex = nearest(400 * pageTarget, pageArray)[1];
    slideAll(pageIndex);
}

function dragDuring() {
    var l = parseInt($(".slider-nav ul").css("left")) - $("body").width() / 2;
    $(".selector ul").css("marginLeft", l - 2);
    var dragPercent = parseFloat($(".selector ul").css("margin-left")) / $(".slider-nav ul").width(), pageMargin = $(".slider-content").width() * dragPercent;
    $(".slider-content").css("left", pageMargin);
}

function pageDragDuring() {
    var bodyW = $("body").width() / 2, dragPercent = parseInt($(".slider-content").css("left")) / $(".slider-content").width(), selectMargin = dragPercent * $(".slider-nav ul").width(), navMargin = bodyW + selectMargin;
    $(".slider-nav ul").css("left", navMargin), $(".selector ul").css("marginLeft", selectMargin - 2), 
    console.log(selectMargin - 2);
}

function nearest(num, arr) {
    var i = 0, res = arr.reduce(function(prev, curr) {
        return Math.abs(curr - num) < Math.abs(prev - num) ? (i++, curr) : prev;
    });
    return [ res, i ];
}

function slideAll(index) {
    var r = -79 * index, m = $("body").width() / 2 + r, e = "easeOutExpo", time = 700, pageMargin = 100 * index;
    $(".selector ul").stop().animate({
        marginLeft: r
    }, time, e), $(".slider-nav ul").stop().animate({
        left: m
    }, time, e), $(".slider-content").stop().animate({
        left: "-" + pageMargin + "%"
    }, time, e), console.log("** " + r), goalFunc(index);
    var newTitle = $(".slidee").eq(index).attr("class").split("slidee ")[1];
    newTitle != view.title && (view.title = newTitle, $("footer").scrollTop() && $("footer").scrollTop(0));
}

function goalFunc(index) {
    $(".slidee.goals .module").eq(index - 1).removeClass("goalClosed"), $(".slidee.goals .module").not(":eq(" + (index - 1) + ")").addClass("goalClosed");
}

function appReady() {}

function pageReady() {
    this.$watch("name", function(newValue) {
        this.title = newValue;
    }), this.$watch("title", this.$parent.changeTitle), this.loadContent();
}

function changePage(item) {
    var newPage = item.name;
    $("#" + newPage).hasClass("current") ? this.closeMenu() : ($("section.main").empty(), 
    view.viewData = {}, view.name = newPage, this.closeMenu(), view.loadContent());
}

function loadContent() {
    var file = "build/templates/" + this.name + ".html";
    $.get(file, function(html) {
        $("section.main").html(html);
    }).done(function() {
        setTimeout(function() {
            eval(view.name + "Func()");
        }, 350);
    });
}

function closeMenu() {
    this.changeTitle(view.title), this.menuOpen = !1;
}

function openMenu() {
    this.menuOpen = !0, $(".current").removeClass("current"), $("#pages #" + view.name).addClass("current"), 
    this.changeTitle("menu");
}

function changeTitle(newTitle) {
    document.title = "Healthi: " + newTitle.substr(0, 1).toUpperCase() + newTitle.substr(1, newTitle.length), 
    $("h1#title span").addClass("old"), $("h1#title").prepend("<span class='new'>" + newTitle + "</span>"), 
    setTimeout(function() {
        $(".new").css("margin-top", 0), setTimeout(function() {
            $(".old").remove(), $("span.new").removeClass("new");
        }, 400);
    }, 0);
}

Vue.component("Page", {
    template: "hello",
    ready: pageReady,
    data: {
        name: "home",
        title: "home",
        viewData: {}
    },
    methods: {
        loadContent: loadContent
    }
});

var app = new Vue({
    el: "body",
    ready: appReady,
    data: {
        menuOpen: !1,
        views: [ {
            name: "home",
            icon: "h"
        }, {
            name: "settings",
            icon: "C"
        } ]
    },
    methods: {
        toggleMenu: function() {
            this.menuOpen ? this.closeMenu() : this.openMenu();
        },
        closeMenu: closeMenu,
        changeTitle: changeTitle,
        openMenu: openMenu,
        changePage: changePage
    }
}), view = app.$.pageref;